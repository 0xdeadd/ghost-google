---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title="Blog">
  <h1><span class="prompt">$</span> ls ~/blog/</h1>
  
  <p class="page-intro">
    All posts documenting my journey through verification hell. 
    Organized by date of frustration.
  </p>

  {posts.length === 0 ? (
    <div class="no-posts">
      <p>drwxr-xr-x  0 user user    0 Jan 13 00:00 .</p>
      <p class="comment"># No posts yet. Directory is empty.</p>
    </div>
  ) : (
    <ul class="post-list">
      {posts.map((post) => (
        <li class="post-item">
          <a href={`/blog/${post.slug}`}>
            <span class="permissions">-rw-r--r--</span>
            <span class="post-date">{post.data.date.toISOString().split('T')[0]}</span>
            <span class="post-title">{post.data.title}</span>
          </a>
          {post.data.description && (
            <p class="post-desc">{post.data.description}</p>
          )}
        </li>
      ))}
    </ul>
  )}
</BaseLayout>

<style>
  .page-intro {
    margin-bottom: 2rem;
    color: var(--text-dim);
  }

  .no-posts {
    font-family: 'IBM Plex Mono', monospace;
    padding: 1rem;
    background: var(--bg-terminal);
    border: 2px solid var(--border-strong);
    border-radius: 4px;
    color: #00ff41;
  }

  .no-posts p {
    margin: 0.25rem 0;
    color: #00ff41;
  }

  .no-posts .comment {
    color: #888;
    font-style: italic;
  }

  .post-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .post-item {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .post-item:last-child {
    border-bottom: none;
  }

  .post-item a {
    display: flex;
    gap: 1rem;
    text-decoration: none;
    align-items: baseline;
    flex-wrap: wrap;
  }

  .permissions {
    font-size: 0.8rem;
    color: var(--text-muted);
    display: none;
  }

  @media (min-width: 600px) {
    .permissions {
      display: inline;
    }
  }

  .post-date {
    font-size: 0.85rem;
    color: var(--text-dim);
    min-width: 100px;
  }

  .post-title {
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 500;
  }

  .post-item a:hover .post-title {
    color: var(--accent);
  }

  .post-desc {
    margin: 0.5rem 0 0 0;
    color: var(--text-muted);
    font-size: 0.9rem;
    padding-left: 0;
  }

  @media (min-width: 600px) {
    .post-desc {
      padding-left: calc(100px + 1rem);
    }
  }
</style>
